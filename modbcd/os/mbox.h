/*
*********************************************************************************************************
*                                                 OS LIB 
*
*                          (c) Copyright 2018, Dumor, All Rights Reserved
*
*
* @file   : mbox.c
* @brief  : message box
* @author : Zaki
*********************************************************************************************************
*/
#ifndef __ZAKI_MBOX_H__
#define __ZAKI_MBOX_H__


#ifdef __cplusplus
extern "C" {
#endif


#include <avr/io.h>


/*
*********************************************************************************************************
*
*                                     CODE SWITCH CONFIG 
*
*********************************************************************************************************
*/
#define  __MBOX_EN__	  1


/*
*********************************************************************************************************
*
*                               SHORT ALIAS FOR MESSAGE BOX FLAG
*
*********************************************************************************************************
*/
#define  OS_MBOX_MAX	  4


/*
*********************************************************************************************************
*
*                                   THE FUNCTIONS OF MACRO
*
*********************************************************************************************************
*/
#define  OS_ATOMIC_OPERATION(__INS__)	 {   \
	unsigned char _SREG = SREG;		  	     \
	__asm__ volatile ("cli");		  	     \
                                             \
	__INS__							  	     \
                                             \
	SREG = _SREG;					  	     \
}


/*
*********************************************************************************************************
*
*								   	MESSAGE BOX DATA BLOCK
*
*********************************************************************************************************
*/
#if __MBOX_EN__	 > 0
typedef struct _os_mbox _OS_EVENT;

struct _os_mbox {
	void *msg;
};


/*
*********************************************************************************************************
*
*                                   FUNCTIONS DECLARATION
*
*********************************************************************************************************
*/
struct _os_mbox *_OSMboxCreate(void);
void _OSMboxPost(struct _os_mbox *mbox, void *msg);
void *_OSMboxAccept(struct _os_mbox *mbox);


#endif //__MBOX_EN__


#ifdef __cplusplus
}
#endif


#endif //__ZAKI_MBOX_H__

