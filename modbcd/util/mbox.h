/**-----------------------------------------------------------------------------------------------------------------
 * @file	mbox.h
 * @brief   system message box 
 *
 * Copyright (c) 2020 Jim Zhang 303683086@qq.com
 *------------------------------------------------------------------------------------------------------------------
*/

#ifndef _MBOX_H__
#define _MBOX_H__


#ifdef __cplusplus
	extern "C" {
#endif


/*------------------------------------------------------------------------------------------------------------------
 * 
 *												MBOX INCLUDES 
 *
 *------------------------------------------------------------------------------------------------------------------
*/
#include "port.h"


/*------------------------------------------------------------------------------------------------------------------
 * 
 *											   MBOX SHORT ALIAS	
 *
 *------------------------------------------------------------------------------------------------------------------
*/
#define  OS_ATOMIC_OPERATION(__INS__)	 {   \
	ENTER_CRITICAL();						 \
	__asm__ volatile ("cli");		  	     \
                                             \
	__INS__							  	     \
                                             \
	EXIT_CRITICAL();						 \
}


/*------------------------------------------------------------------------------------------------------------------
 * 
 *											   MBOX DATA BLOCKS 
 *
 *------------------------------------------------------------------------------------------------------------------
*/
typedef struct _os_mbox _OS_EVENT;

struct _os_mbox {
	void *msg;
};

/*------------------------------------------------------------------------------------------------------------------
 * 
 *											MBOX FUN DECLARATION
 *
 *------------------------------------------------------------------------------------------------------------------
*/
void	 _OSMboxPost(struct _os_mbox *mbox, void *msg);
void	*_OSMboxAccept(struct _os_mbox *mbox);


#ifdef __cplusplus
	} //extern "C"
#endif


#endif //_MBOX_H__

